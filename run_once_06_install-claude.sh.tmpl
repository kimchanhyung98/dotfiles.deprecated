#!/bin/bash

set -e

echo "[install-claude]"

# 1. Claude Code 설치 (npm)
if command -v npm >/dev/null 2>&1; then
  if ! command -v claude >/dev/null 2>&1; then
    echo "  - Installing Claude Code..."
    npm install -g @anthropic-ai/claude-code || true
  fi
fi

# 2. Claude 로그인 (대화형)
if command -v claude >/dev/null 2>&1; then
  echo "  - Claude login (if not logged in)..."
  claude login || true
fi

# 3. SuperClaude 설치 (pipx)
if command -v pipx >/dev/null 2>&1; then
  if ! command -v superclaude >/dev/null 2>&1; then
    echo "  - Installing SuperClaude..."
    pipx install superclaude || true
    superclaude install --force --yes || true
  fi
fi

# 4. MCP 서버 설정
if command -v claude >/dev/null 2>&1; then
  echo "  - Configuring MCP servers..."

  # Context7 - 라이브러리 문서
  claude mcp add context7 -s user -- npx -y @upstash/context7-mcp@latest 2>/dev/null || true

  # Sequential Thinking - 체계적 사고
  claude mcp add sequential-thinking -s user -- npx -y @modelcontextprotocol/server-sequential-thinking 2>/dev/null || true
fi

# 5. 플러그인 마켓플레이스 추가
if command -v claude >/dev/null 2>&1; then
  echo "  - Adding plugin marketplaces..."
  # 아래 명령어는 Claude Code 세션 내에서 실행해야 합니다
  # /plugin marketplace add claude-plugins-official
  # /plugin marketplace add superpowers-marketplace
  # /plugin marketplace add anthropic-agent-skills
  echo "    Note: Run the following in Claude Code session:"
  echo "    /plugin marketplace add claude-plugins-official"
  echo "    /plugin marketplace add superpowers-marketplace"
fi

echo "[install-claude] done"
